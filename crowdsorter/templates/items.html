{% extends "layout.html" %}

{% block title %}{{ super() }} | {{ collection['name'] }}{% endblock %}

{% block metas %}

    <!-- Metadata -->
    <meta name="description" content="Cast your votes in the {{ collection['name'] }} collection on Crowd Sorter.">
    <meta name="twitter:title" content="{{ collection['name'] }}">
    <meta name="twitter:description" content="Cast your votes in the {{ collection['name'] }} collection on Crowd Sorter.">
    <meta property="og:title" content="{{ collection['name'] }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:description" content="Cast your votes in the {{ collection['name'] }} collection on Crowd Sorter.">
{{ super() }}
{% endblock %}

{% block content %}
{{ super() }}
    <div class="jumbotron text-center">
        <h2 class="title">{{ collection['name'] }}</h2>
    </div>

    {% include "flashes.html" %}

    <div class="container">

        <div class="row">
            <div class="col-sm-8 col-sm-offset-2">
                <ul class="list-group">
                    <div class="list-group-item">
                        <div class="left">
                            Items: {{ collection['item_count'] or 0 }}
                        </div>
                        <div class="right">
                            Votes: {{ collection['vote_count'] or 0 }}
                        </div>
                    </div>
                </ul>
            </div>
        </div>

        <div class="row center">
            <div class="col-sm-8 col-sm-offset-2">
                <a class="btn btn-primary" href="/{{ collection['code'] }}/vote" role="button">
                    Vote on Items
                </a>
            </div>
        </div>

    </div>

    <div class="container-fluid">
        <hr>
    </div>

    <div class="container">
        <div class="col-sm-8 col-sm-offset-2">

            <div class="row">
                <div class="list-group">
                    {% set scale = (collection['scores']|length - 1) / 95 %}
                    {% for item in collection['scores'] %}
                    <div class="list-group-item">
                        <div class="left">
                            {{ item['name'] }}
                        </div>
                        <div class="right">
                            {% if scale %}
                            {% if item['points'] > 0 %}
                            <div class="bar-pos" style="
                                    width: {{ item['points'] / +scale }}%;
                                    opacity: {{ item['confidence'] }};">
                                &nbsp;&nbsp;+ {{ item['points']|round(1) }}
                            </div>
                            {% else %}
                            <div class="bar-neg" style="
                                    width: {{ item['points'] / -scale }}%;
                                    opacity: {{ item['confidence'] }};">
                                &nbsp;&nbsp;- {{ item['points']|abs|round(1) }}
                            </div>
                            {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {% if not collection['locked'] %}
            <div class="row">
                <form id="add-item-form" method="post" class="input-group input-group-lg" target="_blank">
                    <input type="text" class="form-control input-lg" name="name" placeholder="New Item Name">
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-success" title="Add an item" onClick="reload();">
                            <i class="glyphicon glyphicon-plus-sign"></i>
                        </button>
                    </span>
                </form>
            </div>
            {% endif %}

        </div>
    </div>

    {% if not collection['private'] %}
    <div class="container-fluid">
        <hr>
    </div>

    <div class="container">
        <div class="row center">
            <div class="col-sm-8 col-sm-offset-2">
                <a class="btn btn-default" href="https://www.facebook.com/sharer/sharer.php?u={{ url_for('collections.detail', code=collection['code'], _external=True) }}" target="_blank">
                    <img src="{{ url_for('static', filename='images/facebook.png') }}" height=30></img>
                    &nbsp;
                    Share on Facebook
                </a>
                <a class="btn btn-default" href="https://twitter.com/home?status={{ url_for('collections.detail', code=collection['code'], _external=True) }}" target="_blank">
                    <img src="{{ url_for('static', filename='images/twitter.png') }}" height=30></img>
                    &nbsp;
                    Share on Twitter
                </a>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block scripts %}
{{- super() }}
    <!-- Custom -->
    <script type="text/javascript">
        function reload() {
            setTimeout(function() {
                document.getElementById("add-item-form").reset();
                window.location.reload();
            }, 3000);
        }
    </script>
{% endblock %}
